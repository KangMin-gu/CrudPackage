<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="common">

	<insert id="noteFile" parameterType="hashMap">
			INSERT INTO sys990030
			( TABLENAME, FILESEARCHKEY, SAVEFILENAME, ORGFILENAME, FILESIZE, PATH, REGUSER, REGDATE, SITEID, IMGPATH )
			VALUES
			( #{tablename}, #{filesearchkey}, #{savefilename}, #{orgfilename}, #{filesize}, #{path}, #{userno}, now(), #{siteid}, #{imgpath})			
	</insert>
	
	<!-- 담당자로 설정 할 수 있는 회원 수 출력 -->
	<select id="totalcntUser" parameterType="hashMap" resultType="int">
		SELECT COUNT(*)
		FROM me800010
		WHERE 
			SITEID = #{siteid}
			AND ISDELETE = 0
			<if test="username != null">
			AND USERNAME like CONCAT('%',#{username},'%')
			</if>
	</select>
	<!-- 담당자로 설정 할 수 있는 회원 목록 출력  -->
	<select id="popUserList" parameterType="hashMap" resultType="hashMap">
		SELECT * 
		FROM  
			(
			SELECT 
			
			@RNUM:=@RNUM + 1 AS ROWNUM
			,USERNO, USERNAME, USERID, USERDUTY,CHKAUTH
			FROM me800010 ,(SELECT @RNUM := 0) R
			WHERE 
				SITEID= #{siteid}
				AND ISDELETE = 0
				<if test="username != null">
					AND USERNAME like CONCAT('%',#{username},'%')
				</if>
			ORDER BY USERNAME
			) T
		WHERE 
			ROWNUM BETWEEN #{startRowNum} and #{endRowNum}
		
	</select>
	
	<!-- 회원사의 거래처 수 카운터  -->
	<select id="totalcntClient" parameterType="hashMap" resultType="int">
		SELECT COUNT(*)
		FROM sa200010
		WHERE 
			SITEID = #{siteid}
			AND ISDELETE = 0
			<if test="cliname != null">
				AND CLINAME like CONCAT('%',#{cliname},'%')
			</if>
	</select>
	<!-- 선택할 수 있는 거래처 목록 출력  -->
	<select id="popClientList" parameterType="hashMap" resultType="hashMap">
	SELECT * 
	FROM  
		(
		SELECT 		
		@RNUM:=@RNUM + 1 AS ROWNUM
		,A.CLINO, A.CLINAME, A.CALLNAME, A.OWNER
		,B.USERNAME 
		FROM sa200010 A 
		LEFT OUTER JOIN me800010 B ON A.OWNER = B.USERNO
		,(SELECT @RNUM := 0) R
		WHERE 
			A.SITEID= #{siteid}
			AND A.ISDELETE = 0
			<if test="cliname != null">
				AND CLINAME like CONCAT('%',#{cliname},'%')
			</if>
		ORDER BY A.CLINAME
		) T
	WHERE 
		ROWNUM BETWEEN #{startRowNum} and #{endRowNum}		
	</select>
	
		<!-- 회원사의 고객 수 카운터  -->
	<select id="totalCntCust" parameterType="hashMap" resultType="int">
		SELECT COUNT(*)
		FROM CU100010
		WHERE 
			SITEID = #{siteid}
			AND ISDELETE = 0
			<if test="cstname != null">
				AND CUSTNAME like CONCAT('%',#{cstname},'%')
			</if>
	</select>
	<!-- 선택할 수 있는 거래처 목록 출력  -->
	<select id="popCustList" parameterType="hashMap" resultType="hashMap">
	SELECT * 
	FROM  
		(
		SELECT 
		@RNUM:=@RNUM + 1 AS ROWNUM
		,A.CUSTNO,A.CUSTNAME,A.CLINO,B.CLINAME,CONCAT(A.MOBILE1,A.MOBILE2,A.MOBILE3) AS MOBILE, A.EMAIL
		FROM CU100010 A
		LEFT OUTER JOIN sa200010 B ON A.CLINO = B.CLINO
		 ,(SELECT @RNUM := 0) R
		WHERE 
			A.SITEID= #{siteid}
			AND A.ISDELETE = 0
			<if test="cstname != null">
				AND CUSTNAME like CONCAT('%',#{cstname},'%')
			</if>
		ORDER BY A.CUSTNO
		) T
	WHERE 
		ROWNUM BETWEEN #{startRowNum} and #{endRowNum}		
	</select>
	
	<!-- 내부통지 파일다운로드 -->
	<select id="noteDownload" parameterType="fileDto" resultType="fileDto">
		SELECT SAVEFILENAME, PATH, ORGFILENAME, FILESIZE, FILEID FROM sys990030 WHERE SITEID = #{siteid} AND FILEID = #{fileid}
	</select>
	
	<!-- 회원사의 영업 수 카운터  -->
	<select id="totalcntSales" parameterType="hashMap" resultType="int">
		SELECT COUNT(*)
		FROM sa210010
		WHERE 
			SITEID = #{siteid}
			AND ISDELETE = 0
			<if test="salename != null">
				AND SALENAME like CONCAT('%',#{salename},'%')
			</if>
	</select>
	<!-- 선택할 수 있는 영업 목록 출력  -->
	<select id="popSalesList" parameterType="hashMap" resultType="hashMap">
	SELECT * 
	FROM  
		(
		SELECT 		
		@RNUM:=@RNUM + 1 AS ROWNUM
		,A.SALESNO, A.SALENAME, A.CLINO, A.OWNER
		,B.USERNAME
		,C.CLINAME 
		FROM sa210010 A 
		LEFT OUTER JOIN me800010 B ON A.OWNER = B.USERNO
		LEFT OUTER JOIN sa200010 C ON A.CLINO = C.CLINO
		,(SELECT @RNUM := 0) R
		WHERE 
			A.SITEID= #{siteid}
			AND A.ISDELETE = 0
			<if test="salename != null">
				AND SALENAME like CONCAT('%',#{salename},'%')
			</if>
		ORDER BY A.SALENAME
		) T
	WHERE 
		ROWNUM BETWEEN #{startRowNum} and #{endRowNum}		
	</select>

</mapper>