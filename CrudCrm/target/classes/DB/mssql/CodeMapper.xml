<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu">

    <select id="list" parameterType="codeDto" resultType="hashMap">
    SELECT 
    A.CODENO,A.CODEGRP,A.CODENAME,A.CODEVAL
    ,CONVERT(nvarchar,A.REGDATE,23) AS REGDATE
    ,CASE WHEN ISDELETE = 0 THEN '사용'
    	  WHEN ISDELETE = 1 THEN '미사용' END AS ISDELETE_
   	,B.CODENAME AS UPPERCODENAME_
    FROM Crud_SaaS.dbo.T_CODE A 
    LEFT OUTER JOIN Crud_SaaS.dbo.T_CODE B ON B.UPPERCODEGRP = A.CODEGRP AND B.UPPERCODEVAL = A.CODEVAL
    WHERE ISDELETE = 0
    <if test ="siteid = 1">
    	AND SITEID = 1
    </if>
    <if test="siteid != 1">
    	AND SITEID = {siteid}
    </if>
    <if test ="codename != null">
    	AND A.CODENAME LIKE '%'+#{codename}+'%'
    </if>
    <if test ="codegrp != null">
    	AND A.CODEGRP LIKE '%'+#{codegrp}+'%'
    </if>

    </select>
    <select id="totalRow" parameterType="codeDto" resultType="int">
     	SELECT 
   			count(*)
   			FROM Crud_SaaS.dbo.T_CODE
    		WHERE ISDELETE = 0
    	<if test ="siteid = 1">
    		AND SITEID = 1
    	</if>
    	<if test="siteid != 1">
	    	AND SITEID = {siteid}
    	</if>
    	<if test ="codename != null">
    		AND A.CODENAME LIKE '%'+#{codename}+'%'
    	</if>
    	<if test ="codegrp != null">
	    	AND A.CODEGRP LIKE '%'+#{codegrp}+'%'
	    </if>
    </select>
    
    <select id="detail" parameterType="codeDto" resultType="hashMap">
     	  SELECT 
    		A.CODENO,A.CODEGRP,A.CODENAME,A.CODEVAL
    		,CONVERT(nvarchar,A.REGDATE,23) AS REGDATE
    		,CASE WHEN ISDELETE = 0 THEN '사용'
    	  		  WHEN ISDELETE = 1 THEN '미사용' END AS ISDELETE_
   			,B.CODENAME AS UPPERCODENAME_
    	FROM Crud_SaaS.dbo.T_CODE A 
    	LEFT OUTER JOIN Crud_SaaS.dbo.T_CODE B ON B.UPPERCODEGRP = A.CODEGRP AND B.UPPERCODEVAL = A.CODEVAL
    	WHERE SITEID = #{siteid}
    	AND CODENO = #{codeno}
    	
    </select>
    
    <update id="update" parameterType="codeDto">
    
    UPDATE Crud_SaaS.dbo.T_CODE
    SET 
    	CODEGRP = #{codegrp}
    	,CODENAME = #{codename}
    	,CODEVAL = #{codeval}
    	,UPPERCODE = #{uppercode}
    	,ISDELETE = #{isdelete}
    	,EDTDATE = getDate()
    	,EDTUSER = #{edtuser}
    WHERE SITEID = #{siteid}
    AND CODENO = #{codeno}
    
    </update>
    <insert id="insert" parameterType="codeDto">
    <selectKey keyProperty="codeno"  resultType="integer" order="AFTER">
    INSERT INTO Crud_SaaS.dbo.T_CODE
    (
    CODEGRP
    ,CODENAME
    ,CODEVAL
    ,UPPERCODE
    ,SITEID
    ,ISDELETE
    ,REGDATE
    ,REGUSER
    ,EDTDATE
    ,EDTUSER
    )VALUES(
    #{codegrp}
    ,#{codename}
    ,#{codeval}
    ,#{uppercode}
    ,#{siteid}
    ,#{isdelete}
    ,getDate()
    ,#{reguser}
    ,getDate()
    ,#{edtuser}
    )
    SELECT SCOPE_IDENTITY()
    </selectKey>
    </insert>
    
    <update id="delete" parameterType="codeDto">
    
    UPDATE Crud_SaaS.dbo.T_CODE
    SET ISDELETE = 1
    ,EDTDATE = getDate()
    ,EDTUSER = #{edtuser}
    WHERE SITEID = #{siteid}
    AND CODENO = #{codeno}
    
    </update>

</mapper>